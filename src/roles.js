const section = {
    "Race Control": {
        "name": "Race Control",
        "start": {
            "adult": "06:00",
            "junior": "11:15"
        },
        "end": {
            "adult": "10:30",
            "junior": "14:30"
        },
        "role": {
            "Lead": {
                "name": "Lead",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 1,
                        "max": 1
                    }
                }
            },
            "Volunteer Coordinator": {
                "name": "Volunteer Coordinator",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 1,
                        "max": 1
                    }
                }
            },
            "Asst. Coordinator": {
                "name": "Asst. Coordinator",
                "qty": {
                    "adult": {
                        "min": 0,
                        "max": 1
                    },
                    "junior": {
                        "min": 0,
                        "max": 1
                    }
                }
            },
            "Safety Officer": {
                "name": "Safety Officer",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 1,
                        "max": 1
                    }
                }
            },
            "Race Briefings": {
                "name": "Race Briefings",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 1,
                        "max": 2
                    }
                }
            },
            "Referee": {
                "name": "Referee",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 1,
                        "max": 1
                    }
                }
            },
            "Asst. Referee": {
                "name": "Asst. Referee",
                "qty": {
                    "adult": {
                        "min": "0",
                        "max": 1
                    },
                    "junior": {
                        "min": "0",
                        "max": 1
                    }
                }
            },
            "Motor Cycle Marshall": {
                "name": "Motor Cycle Marshall",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 2
                    },
                    "junior": {
                        "min": 0,
                        "max": 0
                    }
                }
            },
        }
    },
    "Registration": {
        "name": "Registration",
        "start": {
            "adult": "06:00",
            "junior": "9:00"
        },
        "end": {
            "adult": "08:30",
            "junior": "12:00"
        },
        "role": {
            "Lead": {
                "name": "Lead",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 0,
                        "max": 1
                    }
                }
            },
            "Identity Checks": {
                "name": "Identity Checks",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": "0",
                        "max": "0"
                    }
                }
            },
            "Registration": {
                "name": "Registration",
                "qty": {
                    "adult": {
                        "min": 2,
                        "max": 2
                    },
                    "junior": {
                        "min": 2,
                        "max": "3"
                    }
                }
            },
            "Marker": {
                "name": "Marker",
                "qty": {
                    "adult": {
                        "min": "2",
                        "max": "3"
                    },
                    "junior": {
                        "min": "2",
                        "max": "3"
                    }
                }
            }
        }
    },
    "Car Park": {
        "name": "Car Park",
        "start": {
            "adult": "06:00",
            "junior": "12:00"
        },
        "end": {
            "adult": "11:00",
            "junior": "14:00"
        },
        "role": {
            "Art Centre": {
                "name": "Art Centre",
                "qty": {
                    "adult": {
                        "min": 2,
                        "max": 2
                    },
                    "junior": {
                        "min": "0",
                        "max": "0"
                    }
                }
            }
        }
    },
    "Swim": {
        "name": "Swim",
        "start": {
            "adult": "06:30",
            "junior": "11:15"
        },
        "end": {
            "adult": "09:15",
            "junior": "13:15"
        },
        "role": {
            "Lead": {
                "name": "Lead",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 0,
                        "max": 1
                    }
                }
            },
            "Pool Entry": {
                "name": "Pool Entry",
                "qty": {
                    "adult": {
                        "min": "1",
                        "max": "1"
                    },
                    "junior": {
                        "min": 1,
                        "max": 1
                    }
                }
            },
            "Starter": {
                "name": "Starter",
                "qty": {
                    "adult": {
                        "min": 3,
                        "max": 6
                    },
                    "junior": {
                        "min": 3,
                        "max": 6
                    }
                }
            },
            "Lap Counter": {
                "name": "Lap Counter",
                "qty": {
                    "adult": {
                        "min": 6,
                        "max": 6
                    },
                    "junior": {
                        "min": 6,
                        "max": 6
                    }
                }
            },
            "Marshall": {
                "name": "Marshall",
                "qty": {
                    "adult": {
                        "min": 2,
                        "max": "3"
                    },
                    "junior": {
                        "min": 2,
                        "max": "3"
                    }
                }
            },
            "Collect Hats": {
                "name": "Collect Hats",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": "2"
                    },
                    "junior": {
                        "min": 2,
                        "max": 2
                    }
                }
            },
            "Timing Chips": {
                "name": "Timing Chips",
                "qty": {
                    "adult": {
                        "min": "0",
                        "max": "0"
                    },
                    "junior": {
                        "min": "0",
                        "max": "0"
                    }
                }
            }
        }
    },
    "Cycle": {
        "name": "Cycle",
        "start": {
            "adult": "06:30",
            "junior": "11:15"
        },
        "end": {
            "adult": "10:30",
            "junior": "14:30"
        },
        "role": {
            "Lead": {
                "name": "Lead",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 0,
                        "max": 1
                    }
                }
            },
            "Swim Bridge": {
                "name": "Swim Bridge",
                "qty": {
                    "adult": {
                        "min": "1",
                        "max": "3"
                    },
                    "junior": {
                        "min": "1",
                        "max": "2"
                    }
                }
            },
            "Mount/Dismount": {
                "name": "Mount/Dismount",
                "qty": {
                    "adult": {
                        "min": 2,
                        "max": 2
                    },
                    "junior": {
                        "min": 2,
                        "max": 2
                    }
                }
            },
            "On Course": {
                "name": "On Course",
                "qty": {
                    "adult": {
                        "min": 0,
                        "max": 0
                    },
                    "junior": {
                        "min": 3,
                        "max": 3
                    }
                }
            },
            "Lap Counter": {
                "name": "Lap Counter",
                "qty": {
                    "adult": {
                        "min": 0,
                        "max": 0
                    },
                    "junior": {
                        "min": 2,
                        "max": 2
                    }
                }
            },
            "Morrison Roundabout": {
                "name": "Morrison Roundabout",
                "qty": {
                    "adult": {
                        "min": 2,
                        "max": 2
                    },
                    "junior": {
                        "min": 0,
                        "max": 0
                    }
                }
            },
            "Hatch End Ped. Crossing": {
                "name": "Hatch End Ped. Crossing",
                "qty": {
                    "adult": {
                        "min": "1",
                        "max": "2"
                    },
                    "junior": {
                        "min": 0,
                        "max": 0
                    }
                }
            },
            "King George Roundabout": {
                "name": "King George Roundabout",
                "qty": {
                    "adult": {
                        "min": "1",
                        "max": 2
                    },
                    "junior": {
                        "min": 0,
                        "max": 0
                    }
                }
            },
            "King George Lights": {
                "name": "King George Lights",
                "qty": {
                    "adult": {
                        "min": "1",
                        "max": "3"
                    },
                    "junior": {
                        "min": 0,
                        "max": 0
                    }
                }
            },
            "Headstone Zebra Crossing": {
                "name": "Headstone Zebra Crossing",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 0,
                        "max": 0
                    }
                }
            },
            "Headstone/Uxbridge Left": {
                "name": "Headstone/Uxbridge Left",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 0,
                        "max": 0
                    }
                }
            },
            "Field Footbridge": {
                "name": "Field Footbridge",
                "qty": {
                    "adult": {
                        "min": 2,
                        "max": 2
                    },
                    "junior": {
                        "min": 0,
                        "max": 0
                    }
                }
            },
            "Headstone Width Restrict": {
                "name": "Headstone Width Restrict",
                "qty": {
                    "adult": {
                        "min": 3,
                        "max": 3
                    },
                    "junior": {
                        "min": 0,
                        "max": 0
                    }
                }
            },
            "Sign Removal": {
                "name": "Sign Removal",
                "qty": {
                    "adult": {
                        "min": 0,
                        "max": 0
                    },
                    "junior": {
                        "min": "1",
                        "max": "2"
                    }
                }
            }
        }
    },
    "Run": {
        "name": "Run",
        "start": {
            "adult": "07:30",
            "junior": "11:15"
        },
        "end": {
            "adult": "10:30",
            "junior": "2:30"
        },
        "role": {
            "Lead": {
                "name": "Lead",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 0,
                        "max": 1
                    }
                }
            },
            "Lap Bands": {
                "name": "Lap Bands",
                "qty": {
                    "adult": {
                        "min": 2,
                        "max": 2
                    },
                    "junior": {
                        "min": "2",
                        "max": "2"
                    }
                }
            },
            "Water": {
                "name": "Water",
                "qty": {
                    "adult": {
                        "min": 2,
                        "max": 2
                    },
                    "junior": {
                        "min": 2,
                        "max": 2
                    }
                }
            },
            "Finish": {
                "name": "Finish",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 1,
                        "max": 1
                    }
                }
            },
            "Collect Chips": {
                "name": "Collect Chips",
                "qty": {
                    "adult": {
                        "min": 2,
                        "max": 2
                    },
                    "junior": {
                        "min": 2,
                        "max": 2
                    }
                }
            },
            "Medals": {
                "name": "Medals",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 1,
                        "max": 1
                    }
                }
            }
        }
    },
    "Transition": {
        "name": "Transition",
        "start": {
            "adult": "06:00",
            "junior": "10:15"
        },
        "end": {
            "adult": "10:30",
            "junior": "14:30"
        },
        "role": {
            "Lead": {
                "name": "Lead",
                "qty": {
                    "adult": {
                        "min": 1,
                        "max": 1
                    },
                    "junior": {
                        "min": 0,
                        "max": 1
                    }
                }
            },
            "Marshall": {
                "name": "Marshall",
                "qty": {
                    "adult": {
                        "min": 6,
                        "max": 6
                    },
                    "junior": {
                        "min": "8",
                        "max": "12"
                    }
                }
            }
        }
    }
}
const debug = console.log.bind(console)
const sections = Object.keys(section)
const roleMap = sections.map(s => Object.keys(section[s].role).map((r, i) => ({ section: s, role: r }))).flat()

function roles(sec) {
    if (!sec || sec === 'None' || sec === 'Section') {
        let rs = []
        sections.forEach(s => {
            rs = rs.concat(Object.keys(section[s].role))
        })
        return rs
    }
    else return Object.keys(section[sec].role)
}

function selectSection(e, o, form, p, c = '') {
    const v = typeof e === 'string' ? e : e.target.value,
        r = p.querySelector(`ed-form[name=${c + 'role'}]`),
        s = p.querySelector(`ed-form[name=${c + 'section'}]`)
    form[c + 'section'].value = v
    form[c + 'role'].options = ['Role'].concat(roles(v))
    if (v === 'Section') form[c + 'role'].value = 'Role'
    s.setAttribute('param', 'update')
    r.setAttribute('param', 'update')
}
function selectRole(e, o, form, p, c = '') {
    const sn = c + 'section',
        s = p.querySelector(`select[name=${sn}]`),
        v = s.value,
        i = e.target.selectedIndex
    if (v === 'Section') {
        const so = roleMap[i - 1]
        selectSection(so.section, null, form, p, c)
        form[c + 'role'].options = ['Role'].concat(roles(so.section))
        form[c + 'role'].value = e.target.value
        o.setAttribute('param', 'update')
    }
}
function firstLast(name) {
    const nm = name.trim(),
        s = nm.lastIndexOf(' '),
        first = s > 0 ? nm.substring(0, s) : nm,
        last = s > 0 ? nm.substring(s + 1) : ''
    return { first, last }
}

export { section, sections, roles, selectSection, selectRole, firstLast }